(()=>{"use strict";var e={216:(e,t,o)=>{o.r(t),o.d(t,{popular_photos:()=>a});var a=[{date:"1910",loc:"42nd & 5th ave",height:249,id:"708760f-a",desc:"Street scene"},{date:"1936",loc:"42nd & 5th ave",height:145,id:"1508783-a",desc:"Directing traffic and trolley"},{date:"1912",loc:"42nd & 5th ave",height:157,id:"708795f-a",desc:"Ground level view of street"},{date:"1913",loc:"42nd & 5th ave",height:159,id:"712987f-a",desc:"Street scene"},{date:"1928",loc:"42nd & 6th Avenue",height:246,id:"713050f-a",desc:"Street scene"},{date:"1933",loc:"42nd & 6th Avenue",height:130,id:"713043f",desc:"Under the elevated"},{date:"1939",loc:"42nd & 6th Avenue",height:159,id:"709480f-a",desc:"Elevated train demolition"},{date:"1930s",loc:"42nd & 6th Avenue",height:198,id:"1558013",desc:"Street scene"},{date:"1936",loc:"Central Park",height:160,id:"730166f-a",desc:"Aerial view"},{date:"1933",loc:"Central Park",height:133,id:"718268f-b",desc:"Roller skating"},{date:"1938",loc:"Central Park",height:229,id:"718346f-a",desc:"Feeding birds"},{date:"",loc:"Central Park",height:298,id:"718282f-a",desc:"On the lake"},{date:"",loc:"Central Park",height:160,id:"718194f-a",desc:"Riding under an arch"},{date:"1905",loc:"Central Park",height:154,id:"718242f-b",desc:"Ice skaters"},{date:"",loc:"Central Park",height:143,id:"718333f-a",desc:"Playing croquet"},{date:"",loc:"Central Park",height:132,id:"718280f-a",desc:"Quiet corner"},{date:"1892",loc:"Central Park",height:158,id:"718272f-a",desc:"Strolling"},{date:"1933",loc:"Central Park",height:133,id:"718179f-b",desc:"Aerial View"},{date:"1913",loc:"Central Park",height:130,id:"718284f",desc:"Schoolboys drilling"},{date:"1926",loc:"Prospect Park",height:172,id:"706346f-a",desc:"Prospect Park Plaza"},{date:"1880",loc:"Prospect Park",height:116,id:"706348f-b",desc:"Lake view"},{date:"1864",loc:"Central Park",height:168,id:"718385f-a",desc:"Rustic arbor"},{date:"1892",loc:"Central Park",height:164,id:"718262f-a",desc:"Fountain"},{date:"1933",loc:"Roosevelt Island",height:158,id:"732193f-a",desc:"Welfare (Roosevelt) Island"},{date:"1934",loc:"Brooklyn Bridge",height:134,id:"730718f-c",desc:"Aerial View"},{date:"1932",loc:"86th & 3rd",height:130,id:"714705f-a",desc:"Storefronts"},{date:"1926",loc:"Colonial & Nassau",height:154,id:"726358f-c",desc:"Family on porch"},{date:"1939",loc:"Duane & West",height:136,id:"719363f-a",desc:"Horse-drawn cart"},{date:"1929",loc:"Weehawken & Christopher",height:134,id:"724321f-b",desc:"Coca-Cola ad"},{date:"",loc:"George Washington Bridge",height:156,id:"1558509",desc:""},{date:"1906",loc:"Bayard & Chrystie",height:159,id:"716608f-a",desc:"Street scene"},{date:"1931",loc:"5th & 46th",height:159,id:"708851f-a",desc:"Street scene"},{date:"1933",loc:"Columbus Circle",height:155,id:"719145f-a",desc:"Tribute to Columbus"},{date:"1910",loc:"Pelham Parkway",height:146,id:"701498f-b",desc:"At the racetrack"},{date:"1936",loc:"9th & 40th",height:129,id:"732438f-b",desc:"Food vendors"},{date:"1911",loc:"Poppy Joe Island Beach",height:160,id:"730622f-a",desc:"Local muskrat hunters"},{date:"1890",loc:"Wallabout Bay",height:102,id:"734085f-a",desc:"Ship in port"},{date:"1933",loc:"Greenwich Village",height:299,id:"730568f-a",desc:"Art Exhibit"},{date:"1936",loc:"Battery Park",height:134,id:"716520f-c",desc:"Aerial view"},{date:"1921",loc:"New Chambers & Madison",height:141,id:"721912f-b",desc:"Cobblestone"},{date:"1918",loc:"5th & 25th",height:242,id:"731285f-a",desc:"Victory Arch"},{date:"1925",loc:"Minetta & MacDougal",height:168,id:"721650f-a",desc:"Alley"},{date:"1932",loc:"Canal & Chrystie",height:169,id:"718806f-a",desc:"Construction of Sarah Delano Roosevelt Park"},{date:"1933",loc:"Hudson Street",height:299,id:"733360f-c",desc:"Thanksgiving ragamuffins"},{date:"1917",loc:"Queensborough Bridge",height:157,id:"730942f-a",desc:"Construction"},{date:"1903",loc:"Williamsburg Bridge",height:129,id:"731081f",desc:"Under construction"},{date:"1890",loc:"Mott & Park",height:177,id:"721756f-a",desc:"Street scene"},{date:"1900",loc:"Broad St & Wall St",height:159,id:"716841f-a",desc:"Street scene"},{date:"1873",loc:"Brooklyn Bridge",height:153,id:"730663f-a",desc:"Under construction; view of Manhattan"},{date:"1879",loc:"Brooklyn Bridge",height:254,id:"730665f-a",desc:"Under construction; view of Manhattan"},{date:"1939",loc:"Coney Island",height:129,id:"731939f",desc:"Beach scene"},{date:"1922",loc:"Queens",height:152,id:"725900f-a",desc:"Country house (now JFK airport)"},{date:"1901",loc:"Broadway & 34th",height:156,id:"717404f-a",desc:"Street scene with muddy road"},{date:"1921",loc:"Broadway & 34th",height:158,id:"1558433",desc:"View of street scene from elevated tracks"}]},737:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(o(961)),n=o(738),r=o(978),s=new i.default((function(e,t){(0,n.hashToStateObject)(e.substr(1),t)}));function l(){const e=location.pathname+location.search+location.hash;ga("send","pageview",{page:e})}$((function(){const e=function(e){return"initial"in e?"/#":"/#"+(0,n.stateObjectToHash)(e)};var t=function(e){var t="Old NYC";return"photo_id"in e?t+" - Photo "+e.photo_id:"g"in e?t+" - Grid":t};$(window).on("showGrid",(function(o,a){var i={g:a};s.pushState(i,t(i),e(i)),l()})).on("hideGrid",(function(){var o={initial:!0};s.goBackUntil("initial",[o,t(o),e(o)])})).on("openPreviewPanel",(function(){var o={photo_id:!0};s.pushState(o,t(o),e(o))})).on("showPhotoPreview",(function(o,a){var i={photo_id:a};"pop"==$("#expanded").data("grid-key")&&(i.g="pop"),s.replaceState(i,t(i),e(i)),l()})).on("closePreviewPanel",(function(){var o={g:$("#expanded").data("grid-key")};s.goBackUntil("g",[o,t(o),e(o)])})),$(s).on("setStateInResponseToUser setStateInResponseToPageLoad",(function(e,t){(0,n.transitionToStateObject)(t)})),$(s).on("setStateInResponseToPageLoad",(function(){l()})),r.mapPromise.done((function(){s.initialize()}))}))},226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFeedbackText=t.sendFeedback=t.getCookie=t.setCookie=t.deleteCookie=void 0;var o="oldnycid",a=null;"undefined"!=typeof Firebase&&(a=new Firebase("https://brilliant-heat-1088.firebaseio.com/"));let i=null;$.get("//ipinfo.io",(function(e){i={ip:e.ip,location:e.country+"-"+e.region+"-"+e.city}}),"jsonp");let n=$.get("/timestamps.json").then((function(e){return e.ocr_ms}));function r(e,t){document.cookie=e+"="+t+"; path=/"}function s(e){const t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}t.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.setCookie=r,t.getCookie=s;let l=s(o);l||(l="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r(o,l)),t.sendFeedback=function(e,t,o){ga("send","event","link","feedback",{page:"/#"+e});const n=Object.assign(Object.assign({},o),{metadata:{timestamp:Firebase.ServerValue.TIMESTAMP,user_agent:navigator.userAgent,user_ip:i?i.ip:"",location:i?i.location:"",cookie:l}});var r="/feedback/"+e+"/"+t,s=a.child(r),d=$.Deferred();return s.push(n,(function(e){e?(console.error("Error pushing",e),d.reject(e)):d.resolve()})),d},t.getFeedbackText=function(e){var t=$.Deferred();return n.then((function(o){a.child("/feedback/"+e+"/text").orderByKey().once("value",(function(e){let a=null;e.forEach((function(e){var t=e.val();t.metadata.timestamp>o&&(a=t)})),t.resolve(a)}))})),t}},961:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.states=[],this.hashToStateAdapter=e}initialize(){var e=this;$(window).on("popstate",(function(t){e.handlePopState(t.originalEvent.state)}));let t={initial:!0};var o=!1;const a=()=>{history.replaceState({},"",document.location.href),this.replaceState(t,document.title,document.location.href),o&&$(this).trigger("setStateInResponseToPageLoad",t)};this.hashToStateAdapter&&document.location.hash?(o=!0,this.hashToStateAdapter(document.location.hash,(function(e){t=e,a()}))):a()}makeState(e){var t=null;return history.state&&"id"in history.state&&(t=history.state.id),$.extend({length:history.length,previousStateId:t,id:Date.now()+""+Math.floor(1e8*Math.random())},e)}simplifyState(e){var t=$.extend({},e);return delete t.id,delete t.previousStateId,t}handlePopState(e){if(e&&"id"in e){var t=this.states[this.getStateIndexById(e.id)];if(t&&t.expectingBack)return void delete t.expectingBack}var o=function(){$(this).trigger("setStateInResponseToUser",e)}.bind(this);!e&&this.hashToStateAdapter?this.hashToStateAdapter(document.location.hash,(function(t){e=t,o()})):o()}pushState(e,t,o){var a=this.makeState(e);this.states.push(a),history.pushState(a,t,o),document.title=t}replaceState(e,t,o){var a=this.getCurrentState(),i=null,n=null;a&&("id"in a&&(i=this.getStateIndexById(a.id)),"previousStateId"in a&&(n=a.previousStateId));var r=this.makeState(e);null!==n&&(r.previousStateId=n),null!==i?this.states[i]=r:this.states.push(r),history.replaceState(r,t,o),document.title=t}getCurrentState(){return history.state}getStateIndexById(e){for(var t=0;t<this.states.length;t++)if(this.states[t].id==e)return t;return null}getPreviousState(e){if(!("previousStateId"in e))return null;var t=e.previousStateId;if(null==t)return t;var o=this.getStateIndexById(t);if(null!==o)return this.states[o];throw"State out of whack!"}goBackUntil(e,t){if("string"==typeof e)return this.goBackUntil((function(t){return e in t}),t);let o=this.getCurrentState();for(var a=0,i=null;o&&!e(o);)i=o,o=this.getPreviousState(o),a+=1;if(o&&a)return o.expectingBack=!0,history.go(-a),a;if(0==a)return 0;var n=a;1!=n&&(i.expectingBack=!0,history.go(-(n-1))),this.replaceState(t[0],t[1],t[2])}logStack(){for(var e=this.getCurrentState(),t=0;e;)console.log((t>0?"-":" ")+t,this.simplifyState(e)),e=this.getPreviousState(e),t++}}},335:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.STATIC_MAP_STYLE=t.MAP_STYLE=void 0,t.MAP_STYLE=[{stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"administrative",stylers:[{visibility:"simplified"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{color:"#cccccc"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road",elementType:"labels",stylers:[{color:"#94989C"},{visibility:"simplified"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],t.STATIC_MAP_STYLE=function(e){let t="";for(var o=0;o<e.length;o++){var a=e[o],i=[];if(null!=a.featureType&&i.push("feature:"+a.featureType),null!=a.elementType&&i.push("element:"+a.elementType),null!=a.stylers)for(var n=0;n<a.stylers.length;n++)for(const[e,t]of Object.entries(a.stylers[n]))"string"==typeof t&&i.push(e+":"+t.replace(/#/,"0x"));t+="&style="+i.join("%7C")}return t}(t.MAP_STYLE)},799:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findLatLonForPhoto=t.nameForLatLon=t.backOfCardUrlForPhotoId=t.backId=t.libraryUrlForPhotoId=t.descriptionForPhotoId=t.infoForPhotoId=t.loadInfoForLatLon=void 0;const o={};function a(e){return o[e]||{title:"",date:""}}function i(e){return e.replace("f","b").replace(/-[a-z]$/,"")}t.loadInfoForLatLon=function(e){let t;return t="pop"==e?"/popular.json":"/by-location/"+e.replace(",","")+".json",$.getJSON(t).then((function(t){$.extend(o,t);var a=[];for(var i in t)a.push(i);return"pop"!=e&&(n[e]=function(e){for(var t in e){var o=e[t];if(o.original_title)return o.original_title}}(t)),a}))},t.infoForPhotoId=a,t.descriptionForPhotoId=function(e){var t=a(e),o=t.title;o&&(o+=" ");var i=t.date.replace(/n\.d\.?/,"No Date");return i||(i="No Date"),o+i},t.libraryUrlForPhotoId=function(e){return"http://digitalcollections.nypl.org/items/image_id/"+e.replace(/-[a-z]$/,"")},t.backId=i,t.backOfCardUrlForPhotoId=function(e){return"http://images.nypl.org/?id="+i(e)+"&t=w"};const n={};t.nameForLatLon=function(e){return(n[e]||"").replace(/: | - | & /g,"\n")},t.findLatLonForPhoto=function(e,t){var o=e.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+o+".json",success:function(o){t(o[e])}})}},758:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=o(978);let i=null;function n(e,t){a.map.panTo(e),a.map.setZoom(17),i&&i.setMap(null),i=new google.maps.Marker({position:e,map:a.map,title:t})}$((()=>{$("#location-search").on("keypress",(function(e){if(13!==e.which)return;const t=$(this).val();$.getJSON("https://maps.googleapis.com/maps/api/geocode/json",{address:t,key:"AIzaSyClCA1LViYi4KLQfgMlfr3PS0tyxwqzYjA",bounds:"40.490856,-74.260895|41.030091,-73.578699"}).done((e=>{n(e.results[0].geometry.location,t),ga("send","event","link","address-search")})).fail((e=>{console.error(e),ga("send","event","link","address-search-fail")}))})),$("#current-location").on("click",(()=>{navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:o}=e.coords;n({lat:t,lng:o},"Current Location"),ga("send","event","link","current-location")}),(e=>{console.error(e),ga("send","event","link","current-location-error")}))}))}))},536:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCanonicalUrlForPhoto=void 0,t.getCanonicalUrlForPhoto=function(e){return"http://www.oldnyc.org/#"+e}},738:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transitionToStateObject=t.stateObjectToHash=t.hashToStateObject=t.getCurrentStateObject=void 0;const a=o(978),i=o(799);function n(){if(!$("#expanded").is(":visible"))return{};var e=$("#expanded").data("grid-key"),t=$("#grid-container").expandableGrid("selectedId");return t?{photo_id:t,g:e}:{g:e}}function r(e,t){var o=e.match(/(.*),g:(.*)/);if(o)t({photo_id:o[1],g:o[2]});else if("g:"==e.substr(0,2))t({g:e.substr(2)});else if(e.length>0){var a=e;(0,i.findLatLonForPhoto)(a,(function(o){t({photo_id:e,g:o})}))}else t({})}function s(e){return e.photo_id?"pop"==e.g?e.photo_id+",g:pop":e.photo_id:e.g?"g:"+e.g:""}t.getCurrentStateObject=n,t.hashToStateObject=r,t.stateObjectToHash=s,t.transitionToStateObject=function(e){var t=n();r(s(e),(function(e){if(JSON.stringify(t)!=JSON.stringify(e))if("{}"==JSON.stringify(e)&&((0,a.hideAbout)(),(0,a.hideExpanded)()),t.g==e.g)t.photo_id&&!e.photo_id?$("#grid-container").expandableGrid("deselect"):$("#grid-container").expandableGrid("select",e.photo_id);else{var o=e.g;if((0,a.countPhotos)(lat_lons[o]),"pop"==e.g)(0,a.getPopularPhotoIds)().length;else{var n=a.lat_lon_to_marker[o],r=(0,a.parseLatLon)(o);n||(n=(0,a.createMarker)(o,r)),n&&((0,a.selectMarker)(n,lat_lons[o]),a.map.getBounds().contains(r)||a.map.panTo(r))}(0,i.loadInfoForLatLon)(o).done((function(t){(0,a.showExpanded)(e.g,t,e.photo_id)}))}}))}},978:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hideAbout=t.showAbout=t.fillPopularImagesPanel=t.getPopularPhotoIds=t.hideExpanded=t.showExpanded=t.createMarker=t.parseLatLon=t.initialize_map=t.updateYears=t.selectMarker=t.countPhotos=t.mapPromise=t.map=t.lat_lon_to_marker=void 0;const a=o(799),i=o(335),n=o(536),r=o(226),s=o(216),l=[],d=[];t.lat_lon_to_marker={};let c,p,h=[],u=[1800,2e3];function f(e){return"http://maps.googleapis.com/maps/api/staticmap?center="+e+"&zoom=15&size=150x150&key=AIzaSyClCA1LViYi4KLQfgMlfr3PS0tyxwqzYjA&maptype=roadmap&markers=color:red%7C"+e+"&style="+i.STATIC_MAP_STYLE}function g(e){return 1800===e[0]&&2e3===e[1]}function m(e){if(g(u))return Object.values(e||{}).reduce(((e,t)=>e+t),0);{const[t,o]=u;return Object.entries(e||{}).filter((([e])=>Number(e)>t&&Number(e)<=o)).map((([,e])=>e)).reduce(((e,t)=>e+t),0)}}function v(e,t){const o=m(t);var a=0;c&&(a=c.getZIndex(),c.setIcon(p)),e&&(c=e,p=e.getIcon(),e.setIcon(h[o>100?100:o]),e.setZIndex(1e5+a))}function y(e,o){u=[e,o];for(const[e,o]of Object.entries(t.lat_lon_to_marker)){const t=m(lat_lons[e]);t?(o.setIcon(d[Math.min(t,100)]),o.setVisible(!0)):o.setVisible(!1)}w(),$("#time-range-labels").text(`${e}–${o}`)}function b(e,t,o){t&&v(t,lat_lons[e]),(0,a.loadInfoForLatLon)(e).done((function(t){var a=null;t.length<=10&&(a=t[0]),S(e,t,a),o&&a&&o(a)})).fail((function(){}))}function k(e){var o=e.latLng.lat().toFixed(6)+","+e.latLng.lng().toFixed(6);b(o,t.lat_lon_to_marker[o],(function(e){$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",e)})),$(window).trigger("showGrid",o)}function w(){var e=t.map.getBounds();for(var o in lat_lons)if(!(o in t.lat_lon_to_marker)){var a=P(o);e.contains(a)&&x(o,a)}}function P(e){var t=e.split(",");return new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1]))}function x(e,o){const a=m(lat_lons[e]);if(!a)return;const i=new google.maps.Marker({position:o,map:t.map,visible:!0,icon:d[Math.min(a,100)],title:e});return l.push(i),t.lat_lon_to_marker[e]=i,google.maps.event.addListener(i,"click",k),i}function S(e,o,i){if(L(),t.map.set("keyboardShortcuts",!1),$("#expanded").show().data("grid-key",e),$(".location").text((0,a.nameForLatLon)(e)),g(u))$("#filtered-slideshow").hide();else{const[e,t]=u;$("#filtered-slideshow").show(),$("#slideshow-filter-first").text(e),$("#slideshow-filter-last").text(t)}var n=$.map(o,(function(e){var t=(0,a.infoForPhotoId)(e);return function(e,t){if(g(t))return!0;const[o,a]=t;for(let t=0;t<e.years.length;t++){const i=e.years[t];if(i&&Number(i)>=o&&Number(i)<=a)return!0}return!1}(t,u)?$.extend({id:e,largesrc:t.image_url,src:t.thumb_url,width:600,height:400},t):null}));n=n.filter((e=>null!==e)),$("#preview-map").attr("src",f(e)),$("#grid-container").expandableGrid({rowHeight:200,speed:200},n),i&&$("#grid-container").expandableGrid("select",i)}function _(){$("#expanded").hide(),$(document).unbind("keyup"),t.map.set("keyboardShortcuts",!0)}function T(e){return $(e).attr("href").replace("/#","")}function I(){$("#popular").hide(),$(".popular-link").show()}function C(){_(),$("#about-page").show();var e=$("#about-page .container"),t=e.width();t<parseInt(e.css("max-width"),0)&&e.css("margin-left","-"+t/2+"px")}function L(){$("#about-page").hide()}t.mapPromise=$.Deferred(),t.countPhotos=m,t.selectMarker=v,t.updateYears=y,t.initialize_map=function(){var e={zoom:15,maxZoom:18,minZoom:10,center:new google.maps.LatLng(40.74421,-73.9737),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!0,panControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:i.MAP_STYLE};t.map=new google.maps.Map($("#map").get(0),e);var o=$("<div/>").append($("<div/>").addClass("spacer")).get(0);t.map.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var a=t.map.getStreetView();google.maps.event.addListener(a,"visible_changed",(function(){$(".streetview-hide").toggle(!a.getVisible())})),d.push(null),h.push(null);for(var n=0;n<100;n++){var r=n+1,s=1==r?9:13,l=1==r?15:21;d.push({url:"images/sprite-2014-08-29.png",size:new google.maps.Size(s,s),origin:new google.maps.Point(n%10*39,39*Math.floor(n/10)),anchor:new google.maps.Point((s-1)/2,(s-1)/2)}),h.push({url:"images/selected-2014-08-29.png",size:new google.maps.Size(l,l),origin:new google.maps.Point(n%10*39,39*Math.floor(n/10)),anchor:new google.maps.Point((l-1)/2,(l-1)/2)})}var c=google.maps.event.addListener(t.map,"idle",(function(){google.maps.event.removeListener(c),w(),t.mapPromise.resolve(t.map)}));google.maps.event.addListener(t.map,"bounds_changed",(function(){w()}))},t.parseLatLon=P,t.createMarker=x,t.showExpanded=S,t.hideExpanded=_,t.getPopularPhotoIds=function(){return $(".popular-photo:visible a").map((function(e,t){return T(t)})).toArray()},t.fillPopularImagesPanel=function(){var e=(new Date).getTime()-new Date("2015/12/15").getTime(),t=Math.floor(e/86400/1e3)%s.popular_photos.length,o=s.popular_photos.slice(t).concat(s.popular_photos.slice(0,t)),a=$.map(o,(function(e){var t,o=$("#popular-photo-template").clone().removeAttr("id");return o.find("a").attr("href","#"+e.id),o.find("img").attr("border","0").attr("data-src",(t=e.id,"http://oldnyc-assets.nypl.org/600px/"+t+".jpg")).attr("height",e.height),o.find(".desc").text(e.desc),o.find(".loc").text(e.loc),e.date&&o.find(".date").text(" ("+e.date+")"),o.get(0)}));$("#popular").append($(a).show()),$(a).appear({force_process:!0}),$("#popular").on("appear",".popular-photo",(function(){var e;e=$(this).find("img[data-src]").get(0),$(e).attr("src")||$(e).attr("src",$(e).attr("data-src")).removeAttr("data-src")}))},t.showAbout=C,t.hideAbout=L,$((function(){$(document).on("click","#expanded .curtains, #expanded .exit",(function(){_(),$(window).trigger("hideGrid")})),$("#grid-container, #expanded .header").on("click",(function(e){(e.target==this||$(e.target).is(".og-grid"))&&(_(),$(window).trigger("hideGrid"))})),$("#grid-container").on("og-fill","li",(function(e,t){var o,i=$(this).data("image-id");$(t).empty().append($("#image-details-template").clone().removeAttr("id").show()),$(t).parent().find(".og-details-left").empty().append($("#image-details-left-template").clone().removeAttr("id").show()),function(e,t){$(".description",t).html((0,a.descriptionForPhotoId)(e));var o=(0,a.infoForPhotoId)(e),i=(0,a.libraryUrlForPhotoId)(e);t.parent().find(".nypl-link a").attr("href",i),$(".nypl-logo a").attr("href",i);var s=(0,n.getCanonicalUrlForPhoto)(e);if((0,r.getFeedbackText)((0,a.backId)(e)).done((function(a){var n=a?a.text:o.text,r="/ocr.html#"+e,s=e.match("[0-9]f");if(n){var l=t.find(".text");l.text(n.replace(/\n*$/,"")),l.append($("<i>&nbsp; &nbsp; Typos? Help <a target=_blank href>fix them</a>.</i>")),l.find("a").attr("href",r)}else if(s){var d=t.find(".more-on-back");d.find("a.ocr-tool").attr("href",r),d.find("a.nypl").attr("href",i),d.show()}})),"undefined"!=typeof FB){var l=t.find(".comments"),d=l.parent().width();l.empty().append($('<fb:comments data-numposts="5" data-colorscheme="light"/>').attr("data-width",d).attr("data-href",s).attr("data-version","v2.3")),FB.XFBML.parse(l.get(0)),console.log(s)}var c=new ZeroClipboard(t.find(".copy-link"));if(c.on("ready",(function(){c.on("copy",(function(e){e.clipboardData.setData("text/plain",window.location.href)})),c.on("aftercopy",(function(e){var t=$(e.target);t.css({width:t.get(0).offsetWidth}).addClass("clicked").text("Copied!")}))})),"undefined"!=typeof twttr&&twttr.ready((({widgets:e})=>{e.createShareButton(document.location.href,t.find(".tweet").get(0),{count:"none",text:(o.original_title||o.title)+" - "+o.date,via:"Old_NYC @NYPL"})})),"undefined"!=typeof FB){var p=t.find(".facebook-holder");p.empty().append($("<fb:like>").attr({href:s,layout:"button",action:"like",show_faces:"false",share:"true"})),FB.XFBML.parse(p.get(0))}t.off("mousewheel").on("mousewheel",(function(e){var o=t.height(),a=t.get(0).scrollHeight;return!(this.scrollTop===a-o&&e.deltaY<0||0===this.scrollTop&&e.deltaY>0)}))}(i,$(t)),"pop"==$("#expanded").data("grid-key")&&(o=i,(0,a.findLatLonForPhoto)(o,(e=>{let t="New York City";e&&(t=e),$("#preview-map").attr("src",f(t))})))})).on("click",".og-fullimg > img",(function(){var e=$("#grid-container").expandableGrid("selectedId");window.open((0,a.libraryUrlForPhotoId)(e),"_blank")})),$("#grid-container").on("click",".rotate-image-button",(function(e){e.preventDefault();var t=$(this).closest("li").find(".og-fullimg > img"),o=t.data("rotate")||0;o+=90,t.css("transform","rotate("+o+"deg)").data("rotate",o);var i=$("#grid-container").expandableGrid("selectedId");ga("send","event","link","rotate",{page:"/#"+i+"("+o+")"}),(0,r.sendFeedback)(i,"rotate",{rotate:o,original:(0,a.infoForPhotoId)(i).rotation||null})})).on("click",".feedback-button",(function(e){e.preventDefault(),$("#grid-container .details").fadeOut(),$("#grid-container .feedback").fadeIn()})).on("click","a.back",(function(e){e.preventDefault(),$("#grid-container .feedback").fadeOut(),$("#grid-container .details").fadeIn()})),$(document).on("keyup","input, textarea",(function(e){e.stopPropagation()})),$(".popular-photo").on("click","a",(function(e){e.preventDefault();var t=T(this);(0,a.loadInfoForLatLon)("pop").done((function(e){S("pop",e,t),$(window).trigger("showGrid","pop"),$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",t)})).fail((function(){}))})),$("#popular").on("scroll",(function(){$(this).appear({force_process:!0})})),$("#popular .close").on("click",(function(){(0,r.setCookie)("nopop","1"),I()})),$(".popular-link a").on("click",(function(e){$("#popular").show(),$(".popular-link").hide(),$("#popular").appear({force_process:!0}),(0,r.deleteCookie)("nopop"),e.preventDefault()})),document.cookie.indexOf("nopop=")>=0&&I(),$("#about a").on("click",(function(e){e.preventDefault(),C()})),$("#about-page .curtains, #about-page .exit").on("click",L),$("#grid-container").on("click",".feedback button[feedback]",(function(){const e=$(this);let t=!0;if(e.attr("feedback-param")){var o=e.siblings("input, textarea");if(t=o.val(),""==t)return;o.prop("disabled",!0)}e.prop("disabled",!0);const a=$("#grid-container").expandableGrid("selectedId"),i=e.attr("feedback"),n={[i]:t};var s;(0,r.sendFeedback)(a,i,n).then((s=e.get(0),function(){$(s).text("Thanks!")}))})),$("#grid-container").on("og-select","li",(function(){var e=$(this).data("image-id");$(window).trigger("showPhotoPreview",e)})).on("og-deselect",(function(){$(window).trigger("closePreviewPanel")})).on("og-openpreview",(function(){$(window).trigger("openPreviewPanel")})),$("#time-slider").slider({range:!0,min:1800,max:2e3,values:u,slide:(e,t)=>{const[o,a]=t.values;y(o,a)},stop:(e,t)=>{const[o,a]=t.values;ga("send","event","link","time-slider",{page:`/#${o}–${a}`})}}),$("#time-range-summary").on("click",(()=>{$("#time-range").toggle()})),$("#slideshow-all").on("click",(()=>{y(1800,2e3),$("#time-slider").slider({values:u});const e=$("#expanded").data("grid-key");ga("send","event","link","time-slider-clear"),_(),b(e)}))}))}},t={};function o(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,o),n.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=o(978);o(737),o(758),$((function(){(0,e.fillPopularImagesPanel)(),(0,e.initialize_map)()}))})()})();