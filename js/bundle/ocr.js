(()=>{"use strict";var t={226:(t,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getFeedbackText=o.sendFeedback=o.getCookie=o.setCookie=o.deleteCookie=void 0;var e="oldnycid",n=null;"undefined"!=typeof Firebase&&(n=new Firebase("https://brilliant-heat-1088.firebaseio.com/"));let r=null;$.get("//ipinfo.io",(function(t){r={ip:t.ip,location:t.country+"-"+t.region+"-"+t.city}}),"jsonp");let a=$.get("/timestamps.json").then((function(t){return t.ocr_ms}));function i(t,o){document.cookie=t+"="+o+"; path=/"}function c(t){const o=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return o?o.pop():""}o.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},o.setCookie=i,o.getCookie=c;let d=c(e);d||(d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=16*Math.random()|0;return("x"==t?o:3&o|8).toString(16)})),i(e,d)),o.sendFeedback=function(t,o,e){ga("send","event","link","feedback",{page:"/#"+t});const a=Object.assign(Object.assign({},e),{metadata:{timestamp:Firebase.ServerValue.TIMESTAMP,user_agent:navigator.userAgent,user_ip:r?r.ip:"",location:r?r.location:"",cookie:d}});var i="/feedback/"+t+"/"+o,c=n.child(i),l=$.Deferred();return c.push(a,(function(t){t?(console.error("Error pushing",t),l.reject(t)):l.resolve()})),l},o.getFeedbackText=function(t){var o=$.Deferred();return a.then((function(e){n.child("/feedback/"+t+"/text").orderByKey().once("value",(function(t){let n=null;t.forEach((function(t){var o=t.val();o.metadata.timestamp>e&&(n=o)})),o.resolve(n)}))})),o}},799:(t,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.findLatLonForPhoto=o.nameForLatLon=o.backOfCardUrlForPhotoId=o.backId=o.libraryUrlForPhotoId=o.descriptionForPhotoId=o.infoForPhotoId=o.loadInfoForLatLon=void 0;const e={};function n(t){return e[t]||{title:"",date:""}}function r(t){return t.replace("f","b").replace(/-[a-z]$/,"")}o.loadInfoForLatLon=function(t){let o;return o="pop"==t?"/popular.json":"/by-location/"+t.replace(",","")+".json",$.getJSON(o).then((function(o){$.extend(e,o);var n=[];for(var r in o)n.push(r);return"pop"!=t&&(a[t]=function(t){for(var o in t){var e=t[o];if(e.original_title)return e.original_title}}(o)),n}))},o.infoForPhotoId=n,o.descriptionForPhotoId=function(t){var o=n(t),e=o.title;e&&(e+=" ");var r=o.date.replace(/n\.d\.?/,"No Date");return r||(r="No Date"),e+r},o.libraryUrlForPhotoId=function(t){return"http://digitalcollections.nypl.org/items/image_id/"+t.replace(/-[a-z]$/,"")},o.backId=r,o.backOfCardUrlForPhotoId=function(t){return"http://images.nypl.org/?id="+r(t)+"&t=w"};const a={};o.nameForLatLon=function(t){return(a[t]||"").replace(/: | - | & /g,"\n")},o.findLatLonForPhoto=function(t,o){var e=t.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+e+".json",success:function(e){o(e[t])}})}}},o={};function e(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return t[n](a,a.exports,e),a.exports}(()=>{const t=e(799),o=e(226);window.location.search.indexOf("thanks")>=0&&$("#thanks").show();const n=window.location.hash.slice(1);let r;$('[name="photo_id"]').val(n),$("#back-link").attr("href","/#"+n),$("#hi-res").attr("href",(0,t.libraryUrlForPhotoId)(n)),(0,t.findLatLonForPhoto)(n,(function(e){var a=(0,t.loadInfoForLatLon)(e),d=(0,o.getFeedbackText)((0,t.backId)(n));$.when(a,d).done((function(o,e){console.log(o,e);var a=(0,t.infoForPhotoId)(n);r=o,$("img.back").attr("src",(0,t.backOfCardUrlForPhotoId)(n));var d=e?e.text:a.text;d&&$("#text").text(d),$("#submit").click((function(){i("text",{text:$("#text").val()})})),$("#notext").click((function(){i("notext",{notext:!0})})),$(".rotate-image-button").click(c)}))}));var a=$.getJSON("/notext.json");function i(e,i){(0,o.sendFeedback)((0,t.backId)(n),e,i).then((function(){return function(o){var e=$.Deferred();if(Math.random()<.5)for(var n=r.indexOf(o),i=0;i<r.length;i++){var c=r[(i+n)%r.length];if(c.match(/[0-9]f/)&&(0,t.backOfCardUrlForPhotoId)(c)!=(0,t.backOfCardUrlForPhotoId)(o))return e.resolve(c),e}return a.done((function(t){var o=t.photo_ids;console.log("Picking at random from "+o.length+" untranscribed photos."),e.resolve(o[Math.floor(Math.random()*o.length)])})),e}(n)})).then((function(t){var o=location.protocol+"//"+location.host+location.pathname+"?thanks&id="+t+"#"+t;ga("send","event","link","ocr-success",{page:"/#"+n}),window.location.href=o}))}function c(){var e=$("img.back"),r=e.data("rotate")||0;r+=90,e.css("transform","rotate("+r+"deg)").data("rotate",r),(0,o.sendFeedback)((0,t.backId)(n),"rotate-backing",{"rotate-backing":r})}})()})();