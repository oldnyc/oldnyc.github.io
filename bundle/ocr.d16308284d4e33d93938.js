(()=>{"use strict";var t={494:function(t,n){var o=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function a(t){try{s(e.next(t))}catch(t){i(t)}}function c(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},n.setCookie=i,n.getCookie=a,n.sendFeedback=function(t,n,r){return o(this,void 0,void 0,(function*(){ga("send","event","link","feedback",{page:"/#"+t});const o=Object.assign(Object.assign({},r),{metadata:{cookie:c}}),i=`${e}/${t}/${n}`,a=yield fetch(i,{method:"POST",body:JSON.stringify(o)});if(!a.ok)throw new Error(a.statusText);return a.json()}))},n.getFeedbackText=function(t){return o(this,void 0,void 0,(function*(){const n=`${e}/${t}/text`,o=yield fetch(n);if(!o.ok)throw new Error(o.statusText);const r=yield o.json();return r.timestamp>timestamps.ocr_ms?r:null}))};const e="https://danvk-bronzeswift.web.val.run/api/v0";var r="oldnycid";function i(t,n){document.cookie=t+"="+n+"; path=/"}function a(t){const n=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return n?n.pop():""}let c=a(r);c||(c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)})),i(r,c))},441:function(t,n,o){var e=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function a(t){try{s(e.next(t))}catch(t){i(t)}}function c(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const r=o(386),i=o(494);window.location.search.indexOf("thanks")>=0&&$("#thanks").show();const a=window.location.hash.slice(1);let c;$('[name="photo_id"]').val(a),$("#back-link").attr("href","/#"+a),(0,r.findLatLonForPhoto)(a,(function(t){const n=(0,r.loadInfoForLatLon)(t),o=(0,i.getFeedbackText)((0,r.backId)(a));(()=>e(this,void 0,void 0,(function*(){const[t,e]=yield Promise.all([n,o]);console.log(t,e);var i=(0,r.infoForPhotoId)(a);$("#hi-res").attr("href",(0,r.libraryUrl)(a,i.nypl_url)),c=t,$("img.back").attr("src",(0,r.backOfCardUrlForPhotoId)(a));var s=e?e.text:i.text;s&&$("#text").text(s),$("#submit").click((function(){u("text",{text:$("#text").val()})})),$("#notext").click((function(){u("notext",{notext:!0})})),$(".rotate-image-button").click(l)})))().catch((t=>{console.error(t)}))}));var s=$.getJSON("/static/notext.json");function u(t,n){(0,i.sendFeedback)((0,r.backId)(a),t,n).then((function(){return function(t){var n=$.Deferred();const o=c;if(Math.random()<.5)for(var e=o.indexOf(t),i=0;i<o.length;i++){var a=o[(i+e)%o.length];if(a.match(/[0-9]f/)&&(0,r.backOfCardUrlForPhotoId)(a)!=(0,r.backOfCardUrlForPhotoId)(t))return n.resolve(a),n}return s.done((function(t){var o=t.photo_ids;console.log("Picking at random from "+o.length+" untranscribed photos."),n.resolve(o[Math.floor(Math.random()*o.length)])})),n}(a)})).then((function(t){var n=location.protocol+"//"+location.host+location.pathname+"?thanks&id="+t+"#"+t;ga("send","event","link","ocr-success",{page:"/#"+a}),window.location.href=n}))}function l(){var t=$("img.back"),n=t.data("rotate")||0;n+=90,t.css("transform","rotate("+n+"deg)").data("rotate",n),(0,i.sendFeedback)((0,r.backId)(a),"rotate-backing",{"rotate-backing":n})}},386:function(t,n){var o=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function a(t){try{s(e.next(t))}catch(t){i(t)}}function c(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.loadInfoForLatLon=function(t){return o(this,void 0,void 0,(function*(){let n;n="pop"==t?r+"/popular.json":i+"/"+t.replace(",","")+".json";const o=yield fetch(n);if(!o.ok)throw new Error(o.statusText);const a=yield o.json();for(const t of a)e[t.id]=t;return"pop"!=t&&(s[t]=function(t){for(var n of t)if(n.original_title)return n.original_title}(a)),a.map((t=>t.id))}))},n.infoForPhotoId=a,n.descriptionForPhotoId=function(t){var n=a(t),o=n.title;o&&(o+=" ");var e=n.date.replace(/n\.d\.?/,"No Date");return e||(e="No Date"),o+e},n.backId=c,n.backOfCardUrlForPhotoId=function(t){return"http://images.nypl.org/?id="+c(t)+"&t=w"},n.nameForLatLon=function(t){return(s[t]||"").replace(/: | - | & /g,"\n")},n.findLatLonForPhoto=function(t,n){var o=t.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+o+".json",success:function(o){n(o[t])}})},n.libraryUrl=function(t,n){return n||(t=t.replace(/-.*/,""),null!=n?n:`https://digitalcollections.nypl.org/search/index?keywords=${t}`)};const e={},r="",i=r+"/by-location";function a(t){var n;return null!==(n=e[t])&&void 0!==n?n:{title:"",date:"",width:600,height:400,years:[""]}}function c(t){return t.replace("f","b").replace(/-[a-z]$/,"")}const s={}}},n={};!function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}(441)})();