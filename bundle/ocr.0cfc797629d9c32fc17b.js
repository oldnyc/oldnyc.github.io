(()=>{"use strict";var t={494:function(t,o){var n=this&&this.__awaiter||function(t,o,n,e){return new(n||(n=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var o;t.done?r(t.value):(o=t.value,o instanceof n?o:new n((function(t){t(o)}))).then(c,a)}s((e=e.apply(t,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},o.setCookie=i,o.getCookie=c,o.sendFeedback=function(t,o,r){return n(this,void 0,void 0,(function*(){ga("send","event","link","feedback",{page:"/#"+t});const n=Object.assign(Object.assign({},r),{metadata:{cookie:a}}),i=`${e}/${t}/${o}`,c=yield fetch(i,{method:"POST",body:JSON.stringify(n)});if(!c.ok)throw new Error(c.statusText);return c.json()}))},o.getFeedbackText=function(t){return n(this,void 0,void 0,(function*(){const o=`${e}/${t}/text`,n=yield fetch(o);if(!n.ok)throw new Error(n.statusText);const r=yield n.json();return r.timestamp>timestamps.ocr_ms?r:null}))};const e="https://danvk-bronzeswift.web.val.run/api/v0",r="oldnycid";function i(t,o){document.cookie=t+"="+o+"; path=/"}function c(t){const o=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return o?o.pop():""}let a=c(r);a||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const o=16*Math.random()|0;return("x"==t?o:3&o|8).toString(16)})),i(r,a))},441:function(t,o,n){var e=this&&this.__awaiter||function(t,o,n,e){return new(n||(n=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var o;t.done?r(t.value):(o=t.value,o instanceof n?o:new n((function(t){t(o)}))).then(c,a)}s((e=e.apply(t,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0});const r=n(386),i=n(494);window.location.search.includes("thanks")&&$("#thanks").show();const c=window.location.hash.slice(1);let a;$('[name="photo_id"]').val(c),$("#back-link").attr("href","/#"+c),(0,r.findLatLonForPhoto)(c,(function(t){const o=(0,r.loadInfoForLatLon)(t),n=(0,i.getFeedbackText)((0,r.backId)(c));(()=>e(this,void 0,void 0,(function*(){const[t,e]=yield Promise.all([o,n]);console.log(t,e);const i=(0,r.infoForPhotoId)(c);$("#hi-res").attr("href",(0,r.getLibraryUrl)(c,i.nypl_url)),a=t,$("img.back").attr("src",(0,r.backOfCardUrlForPhotoId)(c));const s=e?e.text:i.text;s&&$("#text").text(s),$("#submit").click((function(){l("text",{text:$("#text").val()})})),$("#notext").click((function(){l("notext",{notext:!0})})),$(".rotate-image-button").click(u)})))().catch((t=>{console.error(t)}))}));const s=$.getJSON("/static/notext.json");function l(t,o){return e(this,void 0,void 0,(function*(){yield(0,i.sendFeedback)((0,r.backId)(c),t,o);const n=yield function(t){const o=$.Deferred(),n=a;if(Math.random()<.5){const e=n.indexOf(t);for(let i=0;i<n.length;i++){const c=n[(i+e)%n.length];if(/[0-9]f/.exec(c)&&(0,r.backOfCardUrlForPhotoId)(c)!=(0,r.backOfCardUrlForPhotoId)(t))return o.resolve(c),o}}return s.done((function(t){const n=t.photo_ids;console.log("Picking at random from "+n.length+" untranscribed photos."),o.resolve(n[Math.floor(Math.random()*n.length)])})),o}(c),e=location.protocol+"//"+location.host+location.pathname+"?thanks&id="+n+"#"+n;ga("send","event","link","ocr-success",{page:"/#"+c}),window.location.href=e}))}function u(){const t=$("img.back");let o=t.data("rotate")||0;o+=90,t.css("transform","rotate("+o+"deg)").data("rotate",o),(0,i.sendFeedback)((0,r.backId)(c),"rotate-backing",{"rotate-backing":o})}},386:function(t,o){var n=this&&this.__awaiter||function(t,o,n,e){return new(n||(n=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var o;t.done?r(t.value):(o=t.value,o instanceof n?o:new n((function(t){t(o)}))).then(c,a)}s((e=e.apply(t,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.loadInfoForLatLon=function(t){return n(this,void 0,void 0,(function*(){let o;o="pop"==t?r+"/popular.json":i+"/"+t.replace(",","")+".json";const n=yield fetch(o);if(!n.ok)throw new Error(n.statusText);const c=yield n.json();for(const t of c)e[t.id]=t;return"pop"!=t&&(s[t]=function(t){for(const o of t)if(o.original_title)return o.original_title}(c)),c.map((t=>t.id))}))},o.infoForPhotoId=c,o.descriptionForPhotoId=function(t){const o=c(t);let n=o.title;n&&(n+=" ");let e=o.date.replace(/n\.d\.?/,"No Date");return e||(e="No Date"),n+=e,n},o.backId=a,o.backOfCardUrlForPhotoId=function(t){return"http://images.nypl.org/?id="+a(t)+"&t=w"},o.nameForLatLon=function(t){var o;return(null!==(o=s[t])&&void 0!==o?o:"").replace(/: | - | & /g,"\n")},o.findLatLonForPhoto=function(t,o){const n=t.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+n+".json",success:function(n){o(n[t])}})},o.getLibraryUrl=function(t,o){return o||(t=t.replace(/-.*/,""),null!=o?o:`https://digitalcollections.nypl.org/search/index?keywords=${t}`)},o.getCanonicalUrlForPhoto=function(t){return"http://www.oldnyc.org/#"+t};const e={},r="",i=r+"/by-location";function c(t){var o;return null!==(o=e[t])&&void 0!==o?o:{title:"",date:"",width:600,height:400,years:[""]}}function a(t){return t.replace("f","b").replace(/-[a-z]$/,"")}const s={}}},o={};!function n(e){var r=o[e];if(void 0!==r)return r.exports;var i=o[e]={exports:{}};return t[e].call(i.exports,i,i.exports,n),i.exports}(441)})();