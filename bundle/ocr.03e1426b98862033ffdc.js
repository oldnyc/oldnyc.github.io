(()=>{"use strict";var t={8494:function(t,n){var o=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,a)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},n.setCookie=i,n.getCookie=c,n.sendFeedback=function(t,n,r){return o(this,void 0,void 0,(function*(){ga("send","event","link","feedback",{page:"/#"+t});const o=Object.assign(Object.assign({},r),{metadata:{cookie:a}}),i=`${e}/${t}/${n}`,c=yield fetch(i,{method:"POST",body:JSON.stringify(o)});if(!c.ok)throw new Error(c.statusText);return c.json()}))},n.getFeedbackText=function(t){return o(this,void 0,void 0,(function*(){const n=`${e}/${t}/text`,o=yield fetch(n);if(!o.ok)throw new Error(o.statusText);const r=yield o.json();return r.timestamp>timestamps.ocr_ms?r:null}))};const e="https://danvk-bronzeswift.web.val.run/api/v0",r="oldnycid";function i(t,n){document.cookie=t+"="+n+"; path=/"}function c(t){const n=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return n?n.pop():""}let a=c(r);a||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)})),i(r,a))},6441:function(t,n,o){var e=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,a)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const r=o(4386),i=o(8494);window.location.search.includes("thanks")&&$("#thanks").show();const c=window.location.hash.slice(1);let a;$('[name="photo_id"]').val(c),$("#back-link").attr("href","/#"+c),function(t,n){const o=t.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+o+".json",success:function(n){!function(t){const n=(0,r.loadInfoForLatLon)(t),o=(0,i.getFeedbackText)((0,r.backId)(c));(()=>e(this,void 0,void 0,(function*(){const[t,e]=yield Promise.all([n,o]);console.log(t,e);const i=(0,r.infoForPhotoId)(c);$("#hi-res").attr("href",(0,r.getLibraryUrl)(c,i.nypl_url)),a=t,$("img.back").attr("src",(0,r.backOfCardUrlForPhotoId)(c));const s=e?e.text:i.text;s&&$("#text").text(s),$("#submit").click((function(){l("text",{text:$("#text").val()})})),$("#notext").click((function(){l("notext",{notext:!0})})),$(".rotate-image-button").click(u)})))().catch((t=>{console.error(t)}))}(n[t])}})}(c);const s=$.getJSON("/static/notext.json");function l(t,n){return e(this,void 0,void 0,(function*(){yield(0,i.sendFeedback)((0,r.backId)(c),t,n);const o=yield function(t){const n=$.Deferred(),o=a;if(Math.random()<.5){const e=o.indexOf(t);for(let i=0;i<o.length;i++){const c=o[(i+e)%o.length];if(/[0-9]f/.exec(c)&&(0,r.backOfCardUrlForPhotoId)(c)!=(0,r.backOfCardUrlForPhotoId)(t))return n.resolve(c),n}}return s.done((function(t){const o=t.photo_ids;console.log("Picking at random from "+o.length+" untranscribed photos."),n.resolve(o[Math.floor(Math.random()*o.length)])})),n}(c),e=location.protocol+"//"+location.host+location.pathname+"?thanks&id="+o+"#"+o;ga("send","event","link","ocr-success",{page:"/#"+c}),window.location.href=e}))}function u(){const t=$("img.back");let n=t.data("rotate")||0;n+=90,t.css("transform","rotate("+n+"deg)").data("rotate",n),(0,i.sendFeedback)((0,r.backId)(c),"rotate-backing",{"rotate-backing":n})}},4386:function(t,n){var o=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,i){function c(t){try{s(e.next(t))}catch(t){i(t)}}function a(t){try{s(e.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,a)}s((e=e.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.loadInfoForLatLon=function(t){return o(this,void 0,void 0,(function*(){let n;n="pop"==t?r+"/popular.json":i+"/"+t.replace(",","")+".json";const o=yield fetch(n);if(!o.ok)throw new Error(o.statusText);const c=yield o.json();for(const t of c)e[t.id]=t;return"pop"!=t&&(s[t]=function(t){for(const n of t)if(n.original_title)return n.original_title}(c)),c.map((t=>t.id))}))},n.infoForPhotoId=c,n.descriptionForPhotoId=function(t){const n=c(t);let o=n.title;o&&(o+=" ");let e=n.date.replace(/n\.d\.?/,"No Date");return e||(e="No Date"),o+=e,o},n.backId=a,n.backOfCardUrlForPhotoId=function(t){return"http://images.nypl.org/?id="+a(t)+"&t=w"},n.nameForLatLon=function(t){var n;return(null!==(n=s[t])&&void 0!==n?n:"").replace(/: | - | & /g,"\n")},n.getLibraryUrl=function(t,n){return n||(t=t.replace(/-.*/,""),null!=n?n:`https://digitalcollections.nypl.org/search/index?keywords=${t}`)},n.getCanonicalUrlForPhoto=function(t){return"http://www.oldnyc.org/#"+t},n.parseLatLon=function(t){const n=t.split(",");return[parseFloat(n[0]),parseFloat(n[1])]};const e={},r="",i=r+"/by-location";function c(t){var n;return null!==(n=e[t])&&void 0!==n?n:{title:"",date:"",width:600,height:400,years:[""]}}function a(t){return t.replace("f","b").replace(/-[a-z]$/,"")}const s={}}},n={};!function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}(6441)})();